@page
@model IndexModel
@{
    ViewData["Title"] = "Cadastro";
}
<div class="text-center my-5 w-75">
    <h1 class="display-4">Cadastro</h1>
    <form id="cadastroForm">
        <div class="mb-3 text-start">
            <label for="nome-completo" class="form-label">Nome completo</label>
            <input type="text" class="form-control" id="nome-completo" placeholder="Mariana da Silva" required>
        </div>
        <div class="mb-3 text-start">
            <label for="email" class="form-label">E-mail</label>
            <input type="email" class="form-control" id="email" placeholder="seunome@email.com" required>
        </div>
        <div class="mb-3 text-start">
            <label for="senha" class="form-label">Senha</label>
            <input type="password" class="form-control" id="senha" placeholder="********" required>
        </div>
        <div class="form-check text-start mb-4">
            <input class="form-check-input" type="checkbox" value="" id="termos" required>
            <label class="form-check-label" for="termos">
                Li e estou de acordo com os Termos de Serviço e Política de Privacidade.
            </label>
        </div>
        <button type="submit" class="btn btn-dark w-100">Cadastrar-se</button>
    </form>
    <div class="text-center mt-3">
        <span>Já tem uma conta? <a asp-area="" asp-page="/Entrar">Clique aqui para entrar</a>.</span>
    </div>
</div>

<script>
    const contextUrl = "http://18.188.227.244:8080/verdeviva/usuario/registrar";

    document.getElementById('cadastroForm').addEventListener('submit', async function (event) {
        event.preventDefault(); // Evita o envio padrão do formulário

        const nomeCompleto = document.getElementById('nome-completo').value;
        const email = document.getElementById('email').value;
        const senha = document.getElementById('senha').value;
        const termos = document.getElementById('termos').checked;

        if (!termos) {
            alert('Você precisa aceitar os Termos de Serviço e Política de Privacidade.');
            return;
        }

        try {
            const response = await fetch(contextUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    nomeCompleto: nomeCompleto,
                    senha: senha,
                    contato: { telefone: "", email: email }
                })
            });

            if (response.ok) {
                const data = await response.json();
                // Manipule a resposta bem-sucedida (como redirecionar ou mostrar uma mensagem)
                alert('Cadastro realizado com sucesso!');
                console.log('Resposta da API:', data);
                // Redirecionar o usuário após o cadastro (opcional)
                window.location.href = '/Entrar';
            } else {
                const errorData = await response.json();
                // Manipule os erros retornados pela API
                console.error('Erro no cadastro:', errorData);
                alert('Erro no cadastro: ' + errorData);
            }
        } catch (error) {
            // Erros de rede ou outras falhas
            console.error('Erro de rede:', error);
            alert('Erro de rede. Tente novamente mais tarde.');
        }
    });
</script>